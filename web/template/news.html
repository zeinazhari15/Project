<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kabar Terbaru — Zein Azhari</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen">

  <header class="bg-white shadow">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="text-lg font-bold">M. ZEIN AZHARI</div>
      <nav class="space-x-4">
        <a href="/" class="text-gray-600 hover:text-indigo-600" id="berandaButton">Beranda</a>
        <a href="/dashboard" class="text-gray-600 hover:text-indigo-600" id="dashboardButton">Dashboard</a>
        <a href="/news" class="text-indigo-600 font-semibold" id="newsButton">Kabar Terbaru</a>
        <a href="/history" class="text-gray-600 hover:text-indigo-600" id="historyButton">History</a>
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <section class="bg-white rounded-lg shadow p-6 mb-6">
      <h1 class="text-2xl font-bold mb-2">Tentang Saya</h1>
      <p class="text-gray-600">
        Halo — saya Zein Azhari, QA Engineer fokus pada automation testing (Selenium & Appium). Di halaman ini kamu bisa berlangganan kabar terbaru.
      </p>
    </section>

    <section class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Berlangganan Kabar</h2>

      <!-- pesan error global -->
      <div id="globalMsg" class="hidden mb-4 p-3 rounded text-sm"></div>

      <form id="newsForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Username</label>
          <input id="username" name="username" type="text" class="mt-1 block w-full border rounded px-3 py-2" placeholder="Masukkan username">
          <p id="errUser" class="text-red-600 text-sm mt-1 hidden"></p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Email</label>
          <input id="email" name="email" type="email" class="mt-1 block w-full border rounded px-3 py-2" placeholder="Masukkan email">
          <p id="errEmail" class="text-red-600 text-sm mt-1 hidden"></p>
        </div>

        <div class="flex items-center gap-3">
          <button id="submitBtn" type="button" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Submit</button>
          <a href="/" class="px-4 py-2 border rounded">Kembali ke Home</a>
        </div>
      </form>
    </section>
  </main>

  <!-- Modal Success -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
      <h3 class="text-lg font-semibold mb-2">Berhasil!</h3>
      <p class="text-gray-600 mb-4">Terima kasih — data kamu sudah tersimpan.</p>
      <button id="closeModal" class="px-4 py-2 bg-indigo-600 text-white rounded">Tutup</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('newsForm');
    const btn = document.getElementById('submitBtn');
    const errUser = document.getElementById('errUser');
    const errEmail = document.getElementById('errEmail');
    const globalMsg = document.getElementById('globalMsg');
    const modal = document.getElementById('successModal');
    const closeModal = document.getElementById('closeModal');

    function showError(el, text) {
      el.textContent = text;
      el.classList.remove('hidden');
    }
    function clearError(el) {
      el.textContent = '';
      el.classList.add('hidden');
    }

    btn.addEventListener('click', async () => {
      // clear
      clearError(errUser); clearError(errEmail);
      globalMsg.classList.add('hidden');

      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();

      // validation: both required
      let ok = true;
      if (!username) { showError(errUser, 'Username harus diisi'); ok = false; }
      if (!email) { showError(errEmail, 'Email harus diisi'); ok = false; }

      if (!ok) return;

      // send via fetch (AJAX)
      btn.disabled = true;
      btn.textContent = 'Mengirim...';

      try {
        const res = await fetch('/submit-news', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email })
        });

        if (!res.ok) {
          const text = await res.text();
          globalMsg.textContent = 'Terjadi kesalahan: ' + text;
          globalMsg.className = 'mb-4 p-3 rounded text-sm text-red-700 bg-red-100';
          globalMsg.classList.remove('hidden');
        } else {
          // show success modal
          modal.classList.remove('hidden');
          modal.classList.add('flex');
          // clear form
          form.reset();
        }
      } catch (e) {
        globalMsg.textContent = 'Network error: ' + e.message;
        globalMsg.className = 'mb-4 p-3 rounded text-sm text-red-700 bg-red-100';
        globalMsg.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Submit';
      }
    });

    closeModal.addEventListener('click', () => {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });
  </script>

</body>
</html>
